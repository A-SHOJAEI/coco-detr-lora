project:
  name: coco-detr-lora
  seed: 1337
  deterministic: true

data:
  kind: synthetic_coco
  root: data/smoke_coco
  image_size: [256, 256]
  num_classes: 3
  train_images: 24
  val_images: 12

runtime:
  device: auto
  num_workers: 2
  amp: false
  ddp: false

train:
  # Smoke: extremely small budget to validate the full pipeline end-to-end.
  batch_size: 2
  max_steps: 20
  lr: 1.0e-4
  weight_decay: 1.0e-4
  log_every: 1
  save_every: 999999

eval:
  score_threshold: 0.05
  max_detections_per_image: 100
  calib_bins: 15
  match_iou: 0.5

experiments:
  - name: fasterrcnn_baseline
    model:
      arch: fasterrcnn_r50_fpn
      # Faster R-CNN expects num_classes including background.
      num_classes: 4
      regime: full
    out_dir: runs/smoke/fasterrcnn_baseline

  - name: detr_full
    model:
      arch: detr_r50
      num_classes: ${data.num_classes}
      regime: full
      lora:
        enabled: false
    out_dir: runs/smoke/detr_full

  - name: detr_lora_only_r4_attn
    model:
      arch: detr_r50
      num_classes: ${data.num_classes}
      regime: lora_only
      lora:
        enabled: true
        rank: 4
        alpha: 8
        dropout: 0.0
        placement: attention_only
    out_dir: runs/smoke/detr_lora_only_r4_attn
